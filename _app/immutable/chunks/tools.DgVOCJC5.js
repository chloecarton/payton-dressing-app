import{p as C,o as T}from"./index.CZvGe1lO.js";import{r as _}from"./scheduler.B6yqLnpn.js";function j(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function J(e,t){C(e,1,1,()=>{t.delete(e.key)})}function Q(e,t,r,i,f,o,s,I,x,$,g,k){let d=e.length,l=o.length,u=d;const m={};for(;u--;)m[e[u].key]=u;const w=[],y=new Map,v=new Map,P=[];for(u=l;u--;){const n=k(f,o,u),c=r(n);let a=s.get(c);a?P.push(()=>a.p(n,t)):(a=$(c,n),a.c()),y.set(c,w[u]=a),c in m&&v.set(c,Math.abs(u-m[c]))}const b=new Set,D=new Set;function E(n){T(n,1),n.m(I,g),s.set(n.key,n),g=n.first,l--}for(;d&&l;){const n=w[l-1],c=e[d-1],a=n.key,p=c.key;n===c?(g=n.first,d--,l--):y.has(p)?!s.has(a)||b.has(a)?E(n):D.has(p)?d--:v.get(a)>v.get(p)?(D.add(a),E(n)):(b.add(p),d--):(x(c,s),d--)}for(;d--;){const n=e[d];y.has(n.key)||x(n,s)}for(;l;)E(w[l-1]);return _(P),w}const h="https://script.google.com/macros/s/AKfycbzg4NjPdnQCNybOVkkghQnxf4m3dS0CtUckH-dgp7xQPZQSeeVVmBrvWc8GhWdGvvWIkA/exec";async function S(){try{const e=await fetch(h+"?action=version.latest",{method:"GET",headers:{"Content-type":"text/plain;charset=utf-8"},redirect:"follow"});if(!e.ok)throw new Error(`Failed to fetch data from ${h}: ${e.statusText}`);const t=await e.json();if(e.status!==200)throw new Error("Version could not be found",{cause:e.status});return t.data.version}catch(e){throw console.error("Error fetching data:",e),e}}async function A(){try{const e=await fetch(h+"?action=product.list",{method:"GET",headers:{"Content-type":"text/plain;charset=utf-8"},redirect:"follow"});if(!e.ok)throw new Error(`Failed to fetch data from ${h}: ${e.statusText}`);const t=await e.json();if(e.status!==200)throw new Error("Products could not be found",{cause:e.status});return t.data}catch(e){throw console.error("Error fetching data:",e),e}}async function V(e){try{const t=await fetch(h+"?action=product.get_by_ref&product_ref="+e,{method:"GET",headers:{"Content-type":"text/plain;charset=utf-8"},redirect:"follow"});if(!t.ok)throw new Error(`Failed to fetch data from ${h}: ${t.statusText}`);const r=await t.json();if(t.status!==200)throw new Error(`Product ${e} could not be found`,{cause:t.status});return r.data}catch(t){throw console.error("Error fetching data:",t),t}}function M(e){return new Intl.NumberFormat("ff-FR",{style:"currency",currency:"EUR"}).format(e)}const F=async e=>{console.log("check cached api version");let t=null;if(typeof window>"u")return{error:t};if(!e.getItem("products"))return{error:t};const i=e.getItem("expires_at");if(i&&new Date<=new Date(i))return{error:t};const f=e.getItem("api_version");if(!i||!f)return console.log("Session not properly initialized"),e.clear(),{error:t};try{let o=await S();new Date(f)<new Date(o)?(console.log("New version published"),e.clear()):(console.log("Cache over expiration date"),e.setItem("expires_at",new Date(new Date().getTime()+5*6e4).toISOString()))}catch{t=500}return{error:t}},O=async e=>{let t,r,i=e.get("ref")||void 0,f=null;if(i===void 0)return{product:r};if(typeof window<"u"){const o=sessionStorage.getItem("products");if(o&&(t=JSON.parse(o),r=t.find(s=>s.reference===i),F(sessionStorage),r!==void 0))return{product:r}}try{let o=await V(i);if(r=o.product,typeof window<"u"){let s=sessionStorage.getItem("api_version");(!s||new Date(s)<new Date(o.version))&&sessionStorage.clear()}}catch(o){o instanceof Error&&(o.cause==404&&console.error(`Product ${i} could not be found`),f=o.cause),f=500}return{product:r,error:f}};export{A as a,j as e,O as g,M as n,J as o,F as r,Q as u};
